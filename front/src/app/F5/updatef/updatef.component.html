<div class="container mt-5">
  <h2 class="text-center mb-4">Mettre à jour F5</h2>
  <form [formGroup]="updateForm" (ngSubmit)="onSubmit()">
    <div class="form-group mb-3">
      <label for="client">Client</label>
      <input id="client" type="text" class="form-control" formControlName="client" />
      <div *ngIf="updateForm.get('client')?.touched && updateForm.get('client')?.invalid" class="text-danger">
        Ce champ est obligatoire.
      </div>
    </div>

   <div formArrayName="licences" class="mb-3">
  <label>Licences</label>
  <div *ngFor="let lic of licences.controls; let i = index" [formGroupName]="i" class="row align-items-end mb-2">
    <div class="col-md-4">
      <label>Nom de licence</label>
      <input type="text" class="form-control" formControlName="nomDesLicences" />
    </div>
    <div class="col-md-3">
      <label>quantité</label>
      <input type="text" class="form-control" formControlName="quantite" />
    </div>
    <div class="col-md-3">
      <label>Date d'expiration</label>
      <input type="date" class="form-control" formControlName="dateEx" />
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button type="button" class="btn btn-danger btn-sm" (click)="removeLicence(i)" *ngIf="licences.length > 1">
        Supprimer
      </button>
    </div>
  </div>
  <button type="button" class="btn btn-primary btn-sm" (click)="addLicence()">Ajouter une licence</button>
</div>

    <div class="form-group mb-3">
      <label for="dureeDeLicence">Durée de la Licence</label>
      <input id="dureeDeLicence" type="text" class="form-control" formControlName="dureeDeLicence" />
    </div>

    <div class="form-group mb-3">
      <label for="nomDuContact">Nom du Contact</label>
      <input id="nomDuContact" type="text" class="form-control" formControlName="nomDuContact" />
    </div>

    <div class="form-group mb-3">
      <label for="adresseEmailContact">Adresse Email du Contact</label>
      <input id="adresseEmailContact" type="email" class="form-control" formControlName="adresseEmailContact" />
      <div *ngIf="updateForm.get('adresseEmailContact')?.touched && updateForm.get('adresseEmailContact')?.invalid" class="text-danger">
        Veuillez entrer une adresse email valide.
      </div>
    </div>
    <div class="form-group">
      <label for="mailAdmin">Email Admin</label>
      <input id="mailAdmin" type="email" class="form-control" formControlName="mailAdmin" />
      <div *ngIf="updateForm.get('mailAdmin')?.touched && updateForm.get('mailAdmin')?.invalid" class="text-danger">
        <div *ngIf="updateForm.get('mailAdmin')?.errors?.['email']">Format email invalide</div>
      </div>
    </div>
    <div formArrayName="ccMail" class="form-group">
    <label>Emails en copie (CC)</label>
    <div *ngFor="let ccCtrl of ccMail.controls; let i = index">
      <input [formControlName]="i" type="email" class="form-control mb-2" placeholder="Email CC" />
      <button type="button" class="btn btn-danger btn-sm mb-2" (click)="ccMail.removeAt(i)" *ngIf="ccMail.length > 1">Supprimer</button>
    </div>
    <button type="button" class="btn btn-primary btn-sm" (click)="ccMail.push(fb.control('', Validators.email))">Ajouter un email CC</button>
    </div>
    <div class="form-group mb-3">
      <label for="numero">Numéro</label>
      <input id="numero" type="text" class="form-control" formControlName="numero" />
    </div>

    <div class="form-group mb-3">
      <label for="remarque">Remarque</label>
      <textarea id="remarque" class="form-control" formControlName="remarque"></textarea>
    </div>
    <div class="form-check mb-3">
      <input id="sousContrat" type="checkbox" class="form-check-input" formControlName="sousContrat" />
      <label class="form-check-label" for="sousContrat">Sous Contrat</label>
    </div>
    <!-- Commande Passer Par -->
      <div class="form-group mb-3">
        <label for="commandePasserPar" class="form-label">Commande Passer Par</label>
        <select id="commandePasserPar" formControlName="commandePasserPar" class="form-control">
          <option *ngFor="let option of commandePasserParOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    <button type="submit" class="btn btn-success" [disabled]="updateForm.invalid">Mettre à jour</button>
    <button type="button" class="btn btn-secondary" (click)="onCancel()">Annuler</button>
  </form>
</div>
