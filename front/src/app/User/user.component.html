<div class="container">
  <!-- En-tête avec titre et boutons alignés -->
  <div class="header-row">
    <h2>Liste des utilisateurs</h2>
    <div class="action-group">
      <button (click)="openAddModal()" class="btn btn-sm action-button">
        <i class="fa fa-plus"></i>
      </button>
      <div class="input-group search-box">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Rechercher..." 
          [(ngModel)]="searchTerm" 
          (input)="onSearch()" 
        />
      </div>
    </div>
  </div>

  <!-- Tableau responsive -->
  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Prénom</th>
          <th>Nom</th>
          <th>Date de naissance</th>
          <th>Sexe</th>
          <th>N° téléphone</th>
          <th>Email</th>
          <th>Rôle</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of pagedUsers">
          <td>{{ user.firstname }}</td>
          <td>{{ user.lastname }}</td>
          <td>{{ user.dateOfBirth | date: 'dd/MM/yyyy' }}</td>
          <td>{{ user.sex }}</td>
          <td>{{ user.phoneNumber }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role }}</td>
          <td>
            <div class="d-flex flex-column gap-1">
              <button (click)="openEditModal(user)" class="btn btn-sm btn-primary">
                <i class="fas fa-pen"></i>
              </button>
              <button (click)="deleteUser(user.id)" class="btn btn-sm btn-danger">
                <i class="fas fa-trash"></i>
              </button>
              <button *ngIf="!user.verified" (click)="activateUser(user.id)" class="btn btn-sm btn-success">
                <i class="fas fa-check"></i>
              </button>
              <button *ngIf="user.verified" (click)="deactivateUser(user.id)" class="btn btn-sm btn-warning">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="8" class="text-center">Aucun utilisateur trouvé.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="text-center mt-3">
    <ng-container *ngIf="totalPages > 1">
      <button 
        *ngFor="let page of pageNumbers; let i = index"
        (click)="changePage(i)"
        [class.active]="i === currentPage"
        class="btn btn-sm btn-outline-primary mx-1">
        {{ i + 1 }}
      </button>
    </ng-container>
  </div>
</div>

<!-- Modale Angular - BOOTSTRAP 3 AVEC SCROLL DANS LE FORM -->
<div class="modal fade" [class.in]="showModal" [style.display]="showModal ? 'block' : 'none'" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-light">
        <button type="button" class="close" (click)="closeModal()">&times;</button>
        <h4 class="modal-title">{{ isEditMode ? 'Modifier utilisateur' : 'Ajouter utilisateur' }}</h4>
      </div>

      <!-- MODAL BODY SANS SCROLL -->
      <div class="modal-body" style="padding: 20px;">
        <!-- FORMULAIRE AVEC SCROLL -->
        <form [formGroup]="userForm" style="max-height: 50vh; overflow-y: auto; padding-right: 10px;">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Prénom</label>
                <input type="text" class="form-control" formControlName="firstname">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Nom</label>
                <input type="text" class="form-control" formControlName="lastname">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Date de naissance</label>
                <input type="date" class="form-control" formControlName="dateOfBirth">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Sexe</label>
                <select class="form-control" formControlName="sex">
                  <option value="">Sélectionner</option>
                  <option value="Homme">Homme</option>
                  <option value="Femme">Femme</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Numéro de téléphone</label>
                <input type="text" class="form-control" formControlName="phoneNumber" placeholder="+212 6 00 00 00 00">
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label>Email</label>
                <input type="email" class="form-control" formControlName="email" placeholder="email@example.com">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label>Rôle</label>
                <select class="form-control" formControlName="role">
                  <option value="">Sélectionner un rôle</option>
                  <option value="ROLE_ADMINISTRATEUR">Administrateur</option>
                  <option value="ROLE_COMMERCIAL">Commercial</option>
                  <option value="ROLE_MANAGER">Manager</option>
                </select>
              </div>
            </div>
            <div class="col-md-6" *ngIf="!isEditMode">
              <div class="form-group">
                <label>Mot de passe</label>
                <div class="input-group">
                  <input type="password" class="form-control" formControlName="password" placeholder="●●●●●●●●" id="passwordField">
                  <span class="input-group-addon" style="cursor: pointer; background-color: #fff;" (click)="togglePasswordVisibility()">
                    <i class="glyphicon glyphicon-eye-open" id="passwordIcon"></i>
                  </span>
                </div>
              </div>
            </div>
          
          </div>
        </form>
      </div>

      <!-- Footer fixé en bas -->
      <div class="modal-footer bg-light" style="position: sticky; bottom: 0; background: #f8f9fa !important; border-top: 1px solid #ddd; z-index: 1000;">
        <button type="button" class="btn btn-default" (click)="closeModal()">Annuler</button>
        <button type="button" class="btn btn-primary" (click)="submitForm()" [disabled]="!userForm.valid">
          {{ isEditMode ? 'Modifier' : 'Ajouter' }}
        </button>
      </div>
    </div>
  </div>
</div>