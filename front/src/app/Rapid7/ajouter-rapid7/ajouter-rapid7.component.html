<div class="container mt-5">
  <h2 class="text-center mb-4">Ajouter licence Rapid7</h2>
  
  <form [formGroup]="rapid7Form" (ngSubmit)="addRapid7()">
    <!-- Client -->
    <div class="form-group mb-3">
      <label for="client" class="form-label">Client</label>
      <input
        type="text"
        id="client"
        class="form-control"
        formControlName="client"
        placeholder="Nom du client"
      />
      <div *ngIf="rapid7Form.get('client')?.touched && rapid7Form.get('client')?.invalid" class="text-danger">
        Ce champ est obligatoire.
      </div>
    </div>

<!-- Licences -->
<div formArrayName="licences">
  <label class="form-label">Licences</label>
  <div
    *ngFor="let licence of licences.controls; let i = index"
    [formGroupName]="i"
    class="row align-items-end mb-2"
  >
    <div class="col-md-4">
      <input
        type="text"
        class="form-control"
        placeholder="Nom de licence"
        formControlName="nomDesLicences"
      />
    </div>
    <div class="col-md-3">
      <input
        type="text"
        class="form-control"
        placeholder="quantité"
        formControlName="quantite"
      />
    </div>
    <div class="col-md-4">
      <input
        type="date"
        class="form-control"
        formControlName="dateEx"
      />
    </div>
    <div class="col-md-1">
      <button
        type="button"
        class="btn btn-danger"
        (click)="removeLicence(i)"
        *ngIf="licences.length > 1"
      >
        ×
      </button>
    </div>
  </div>
  <button type="button" class="btn btn-secondary mt-2" (click)="addLicence()">
    Ajouter une licence
  </button>
</div>
 <!-- cle licence -->
    <div class="form-group mb-3">
      <label for="cleLicences" class="form-label">Cle de licence</label>
      <textarea
        id="cleLicences"
        class="form-control"
        formControlName="cleLicences"
        placeholder="Ajouter une cleLicences"
      ></textarea>
    </div>

    

        <!-- Durée de la Licence -->
    <div class="form-group mb-3">
      <label for="dureeDeLicence" class="form-label">Durée de la Licence</label>
      <input
        type="text"
        id="dureeDeLicence"
        class="form-control"
        formControlName="dureeDeLicence"
        placeholder="Durée de la licence"
      />
    </div>

    <!-- Nom du Contact -->
    <div class="form-group mb-3">
      <label for="nomDuContact" class="form-label">Contact Client</label>
      <input
        type="text"
        id="nomDuContact"
        class="form-control"
        formControlName="nomDuContact"
        placeholder="Nom du contact"
      />
    </div>

<!-- Numéro -->
    <div class="form-group mb-3">
      <label for="numero" class="form-label">N° Client</label>
      <input
        type="text"
        id="numero"
        class="form-control"
        formControlName="numero"
        placeholder="Numéro du contact"
      />
    </div>
    <!-- Adresse Email Contact -->
    <div class="form-group mb-3">
      <label for="adresseEmailContact" class="form-label">Email Client </label>
      <input
        type="email"
        id="adresseEmailContact"
        class="form-control"
        formControlName="adresseEmailContact"
        placeholder="Email du contact"
      />
      <div *ngIf="rapid7Form.get('adresseEmailContact')?.touched && rapid7Form.get('adresseEmailContact')?.invalid" class="text-danger">
        Veuillez entrer une adresse email valide.
      </div>
    </div>
    

      <!-- Email Admin -->
<div class="form-group mb-3">
  <label for="mailAdmin" class="form-label">Email Commercial</label>
  <input type="email" id="mailAdmin" formControlName="mailAdmin" class="form-control" placeholder="Email de l'administrateur" />
</div>
<!-- CC Mail -->
<div class="form-group mb-3">
  <label>Emails en copie (CC)</label>
  <div *ngIf="rapid7Form.get('ccMail') as cc">
    <div [formArrayName]="'ccMail'">
      <div *ngFor="let control of cc.controls; let i = index" class="d-flex mb-2">
        <input
          [formControlName]="i"
          type="email"
          class="form-control me-2"
          placeholder="Email en copie"
        />
        <button type="button" class="btn btn-danger" (click)="removeCcMail(i)">Supprimer</button>
      </div>
    </div>
  </div>
  <button type="button" class="btn btn-secondary mt-2" (click)="addCcMail()">Ajouter Email</button>
</div>
    <!-- Remarque -->
    <div class="form-group mb-3">
      <label for="remarque" class="form-label">Remarque</label>
      <textarea
        id="remarque"
        class="form-control"
        formControlName="remarque"
        placeholder="Ajouter une remarque"
      ></textarea>
    </div>
    <!-- Sous Contrat -->
      <div class="form-group mb-3 form-check">
        <input type="checkbox" id="sousContrat" class="form-check-input" formControlName="sousContrat" />
        <label for="sousContrat" class="form-check-label">Sous Contrat</label>
      </div>
 <div class="form-group">
        <label for="commandePasserPar">Commande Passer Par</label>
        <select id="commandePasserPar" formControlName="commandePasserPar" class="form-control">
          <option *ngFor="let option of commandePasserParOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>


  



    <!-- Bouton Ajouter -->
    <button type="submit" class="btn btn-primary" [disabled]="rapid7Form.invalid">
      Ajouter
    </button>
    <button type="button" class="btn btn-secondary" (click)="onCancel()">Annuler</button>
  </form>
  
</div>
