<div class="container mt-5">
  <h2 class="text-center mb-4" style="color:#003366;">Mettre à jour Alwarebytes</h2>

  <div class="form-wrapper">
    <form [formGroup]="updateForm" (ngSubmit)="onSubmit()">

      <!-- Client -->
      <div class="form-group mb-3">
        <label for="client">Client</label>
        <input id="client" type="text" class="form-control" formControlName="client" placeholder="Nom du client" />
        <div *ngIf="updateForm.get('client')?.touched && updateForm.get('client')?.invalid" class="text-danger">
          Ce champ est obligatoire.
        </div>
      </div>

      <!-- Licences -->
      <div formArrayName="licences" class="mb-3">
        <label class="form-label">Licences</label>
        <div *ngFor="let lic of licences.controls; let i = index" [formGroupName]="i" class="row align-items-end mb-2">
          <div class="col-md-4">
            <input type="text" class="form-control" formControlName="nomDesLicences" placeholder="Nom de licence" />
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" formControlName="quantite" placeholder="Quantité" />
          </div>
          <div class="col-md-4">
            <input type="date" class="form-control" formControlName="dateEx" />
          </div>
          <div class="col-md-1 d-flex align-items-end">
            <button type="button" class="btn btn-danger btn-sm" (click)="removeLicence(i)" *ngIf="licences.length > 1">
              ×
            </button>
          </div>
        </div>
        <button type="button" class="btn btn-secondary mt-2" (click)="addLicence()">Ajouter une licence</button>
      </div>

      <!-- Durée de la Licence -->
      <div class="form-group mb-3">
        <label for="dureeDeLicence">Durée de la Licence</label>
        <input id="dureeDeLicence" type="text" class="form-control" formControlName="dureeDeLicence" placeholder="Durée de la licence" />
      </div>

      <!-- Nom du Contact -->
      <div class="form-group mb-3">
        <label for="nomDuContact">Contact Client</label>
        <input id="nomDuContact" type="text" class="form-control" formControlName="nomDuContact" placeholder="Nom du contact" />
      </div>

      <!-- Email Contact -->
      <div class="form-group mb-3">
        <label for="adresseEmailContact">Email Client</label>
        <input id="adresseEmailContact" type="email" class="form-control" formControlName="adresseEmailContact" placeholder="Email du contact" />
      </div>

      <!-- Email Admin -->
      <div class="form-group mb-3">
        <label for="mailAdmin">Email Commercial</label>
        <input id="mailAdmin" type="email" class="form-control" formControlName="mailAdmin" placeholder="Email de l'administrateur" />
        <div *ngIf="updateForm.get('mailAdmin')?.touched && updateForm.get('mailAdmin')?.invalid" class="text-danger">
          <div *ngIf="updateForm.get('mailAdmin')?.errors?.['email']">Format email invalide</div>
        </div>
      </div>

      <!-- CC Mail -->
      <div formArrayName="ccMail" class="form-group mb-3">
        <label>Emails en copie (CC)</label>
        <div *ngFor="let ccCtrl of ccMail.controls; let i = index" class="d-flex mb-2">
          <input [formControlName]="i" type="email" class="form-control me-2" placeholder="Email CC" />
          <button type="button" class="btn btn-danger btn-sm" (click)="ccMail.removeAt(i)" *ngIf="ccMail.length > 1">Supprimer</button>
        </div>
        <button type="button" class="btn btn-secondary mt-2" (click)="ccMail.push(fb.control('', Validators.email))">Ajouter Email CC</button>
      </div>

      <!-- Numéro -->
      <div class="form-group mb-3">
        <label for="numero">N° Client</label>
        <input id="numero" type="text" class="form-control" formControlName="numero" placeholder="Numéro du contact" />
      </div>

      <!-- Remarque -->
      <div class="form-group mb-3">
        <label for="remarque">Remarque</label>
        <textarea id="remarque" class="form-control" formControlName="remarque" placeholder="Ajouter une remarque"></textarea>
      </div>

      <!-- Sous Contrat -->
      <div class="form-check mb-3">
        <input id="sousContrat" type="checkbox" class="form-check-input" formControlName="sousContrat" />
        <label class="form-check-label" for="sousContrat">Sous Contrat</label>
      </div>
<!-- Commande Passer Par -->
      <div class="form-group mb-3">
        <label for="commandePasserPar" class="form-label">Commande Passer Par</label>
        <select id="commandePasserPar" formControlName="commandePasserPar" class="form-control">
          <option *ngFor="let option of commandePasserParOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
      <!-- Boutons -->
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-fill" [disabled]="updateForm.invalid">Mettre à jour</button>
        <button type="button" class="btn btn-secondary flex-fill" (click)="onCancel()">Annuler</button>
      </div>

    </form>
  </div>
</div>
